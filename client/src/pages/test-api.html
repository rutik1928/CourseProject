<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Ads - –¢–µ—Å—Ç API</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 50px auto; 
            padding: 20px; 
        }
        .container { 
            border: 1px solid #ddd; 
            padding: 20px; 
            border-radius: 8px; 
        }
        .form-group { 
            margin: 10px 0; 
        }
        input, button { 
            padding: 10px; 
            margin: 5px; 
            width: 200px; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            cursor: pointer; 
            width: auto;
        }
        button:hover { 
            background: #0056b3; 
        }
        .result { 
            background: #f5f5f5; 
            padding: 10px; 
            margin-top: 10px; 
            border-radius: 4px; 
            white-space: pre-wrap;
        }
        .tab { 
            margin: 10px 0; 
        }
        .tab-button { 
            padding: 8px 16px; 
            margin-right: 5px; 
            cursor: pointer; 
        }
        .tab-content { 
            display: none; 
        }
        .active { 
            background: #007bff; 
            color: white; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó Car Ads - –¢–µ—Å—Ç API</h1>
        
        <div class="tab">
            <button class="tab-button active" onclick="openTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            <button class="tab-button" onclick="openTab('login')">–í—Ö–æ–¥</button>
            <button class="tab-button" onclick="openTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
        </div>

        <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
        <div id="register" class="tab-content" style="display: block;">
            <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
            <div class="form-group">
                <input type="email" id="regEmail" placeholder="Email" value="test@example.com">
            </div>
            <div class="form-group">
                <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="123456">
            </div>
            <div class="form-group">
                <input type="text" id="regName" placeholder="–ò–º—è" value="–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å">
            </div>
            <div class="form-group">
                <input type="text" id="regPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" value="+79991234567">
            </div>
            <button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </div>

        <!-- –í—Ö–æ–¥ -->
        <div id="login" class="tab-content">
            <h3>–í—Ö–æ–¥</h3>
            <div class="form-group">
                <input type="email" id="loginEmail" placeholder="Email" value="test@example.com">
            </div>
            <div class="form-group">
                <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å" value="123456">
            </div>
            <button onclick="login()">–í–æ–π—Ç–∏</button>
        </div>

        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile" class="tab-content">
            <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
            <button onclick="getProfile()">–ü–æ–ª—É—á–∏—Ç—å –º–æ–π –ø—Ä–æ—Ñ–∏–ª—å</button>
            <button onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>

        <div id="result" class="result"></div>
        
        <div style="margin-top: 20px;">
            <h4>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h4>
            <ol>
                <li>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</li>
                <li>–í–æ–π–¥–∏ —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏</li>
                <li>–ü–æ–ª—É—á–∏ –ø—Ä–æ—Ñ–∏–ª—å (–Ω—É–∂–µ–Ω —Ç–æ–∫–µ–Ω)</li>
            </ol>
        </div>
    </div>

    <script>
        let currentToken = localStorage.getItem('token');
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–∫–ª–∞–¥–∫–∞–º–∏
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).style.display = 'block';
            event.currentTarget.classList.add('active');
        }

        // –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
        async function apiRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, data: { error: '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏' } };
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function register() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const name = document.getElementById('regName').value;
            const phone = document.getElementById('regPhone').value;

            showResult('‚è≥ –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º...');

            const result = await apiRequest('/api/auth/register', {
                method: 'POST',
                body: JSON.stringify({ email, password, name, phone })
            });

            if (result.success) {
                currentToken = result.data.token;
                localStorage.setItem('token', currentToken);
                showResult('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!\n–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage\n\n–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n' + 
                          JSON.stringify(result.data.user, null, 2));
                console.log('Token:', currentToken);
            } else {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + result.data.error);
            }
        }

        // –í—Ö–æ–¥
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            showResult('‚è≥ –í—Ö–æ–¥–∏–º...');

            const result = await apiRequest('/api/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            });

            if (result.success) {
                currentToken = result.data.token;
                localStorage.setItem('token', currentToken);
                showResult('‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω!\n–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω\n\n–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n' + 
                          JSON.stringify(result.data.user, null, 2));
                console.log('Token:', currentToken);
            } else {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + result.data.error);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        async function getProfile() {
            if (!currentToken) {
                showResult('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }

            showResult('‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å...');

            const result = await apiRequest('/api/auth/me', {
                headers: {
                    'Authorization': `Bearer ${currentToken}`
                }
            });

            if (result.success) {
                showResult('‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω:\n' + JSON.stringify(result.data.user, null, 2));
                console.log('User:', result.data.user);
            } else {
                showResult('‚ùå –û—à–∏–±–∫–∞: ' + result.data.error);
            }
        }

        // –í—ã—Ö–æ–¥
        function logout() {
            currentToken = null;
            localStorage.removeItem('token');
            showResult('‚úÖ –í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω. –¢–æ–∫–µ–Ω —É–¥–∞–ª–µ–Ω.');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        function showResult(message) {
            document.getElementById('result').textContent = message;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        if (currentToken) {
            showResult('üîë –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω –≤ localStorage. –ú–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å.');
        }
    </script>
</body>
</html>